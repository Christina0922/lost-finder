# Google Maps 지도 기능 테스트 시나리오

## 사전 준비

1. **환경변수 설정**
   ```bash
   # client/.env
   REACT_APP_GOOGLE_MAPS_API_KEY=실제_구글맵_API_키
   REACT_APP_GOOGLE_CLIENT_ID=실제_구글_OAuth_클라이언트_ID
   REACT_APP_API_BASE_URL=http://localhost:5000
   
   # server/.env
   GOOGLE_MAPS_API_KEY=실제_구글맵_API_키
   GOOGLE_CLIENT_ID=실제_구글_OAuth_클라이언트_ID
   PORT=5000
   ```

2. **서버 시작**
   ```bash
   cd server
   npm install
   npm start
   # 또는
   .\start-server.bat
   ```

3. **클라이언트 시작**
   ```bash
   cd client
   npm install
   npm start
   # 또는
   .\start-client.bat
   ```

## 테스트 시나리오

### ✅ 시나리오 1: 장소 검색 및 자동완성 (핵심 기능)

**목표:** "남사중학교" 검색 시 자동완성 작동 및 좌표 획득

**단계:**
1. 메인 페이지에서 "🗺️ 지도에서 찾기" 클릭
2. 검색창에 "남사중학교" 입력
3. **기대결과:**
   - 최대 6개의 자동완성 결과 표시
   - 각 결과에 장소명 + 주소 표시
4. 첫 번째 결과 클릭
5. **기대결과:**
   - 지도가 해당 위치로 중심 이동
   - 파란색 임시 마커 표시
   - 하단에 "📍 이 위치로 등록하기" 버튼 활성화

**검증 포인트:**
- [ ] 자동완성 목록이 0.5초 디바운스 후 표시
- [ ] 자동완성 결과가 최대 6개
- [ ] 선택 시 지도 중심 이동 및 줌 레벨 17
- [ ] "검색 결과가 없어요" 메시지 확인 (잘못된 검색어 입력 시)

---

### ✅ 시나리오 2: 분실물 등록 with 좌표

**목표:** 지도에서 선택한 위치로 분실물 등록

**단계:**
1. 시나리오 1 완료 후 "📍 이 위치로 등록하기" 클릭
2. 등록 화면으로 이동
3. **기대결과:**
   - "분실 장소" 필드에 장소명 자동 입력
   - 녹색 박스에 "✓ 지도에서 선택한 위치" 표시
   - 장소명, 주소, 좌표 표시
4. 분실물 정보 입력:
   - 종류: "자전거"
   - 설명: "빨간색 산악자전거입니다."
   - 이미지 업로드 (선택사항)
5. "등록" 버튼 클릭
6. **기대결과:**
   - 성공 메시지 표시
   - 목록 페이지로 리다이렉트

**검증 포인트:**
- [ ] lat, lng, place_name, address 필드가 DB에 저장됨
- [ ] lost_at (분실시각) 현재시간으로 저장
- [ ] created_by_device_id가 localStorage의 deviceId와 일치
- [ ] 서버 콘솔에 성공 로그 출력

---

### ✅ 시나리오 3: 지도에서 분실물 마커 표시

**목표:** 등록된 분실물이 지도에 마커로 표시

**단계:**
1. 메인 페이지에서 "🗺️ 지도에서 찾기" 클릭
2. **기대결과:**
   - 좌표가 있는 모든 분실물이 마커로 표시
   - 내가 등록한 글은 **녹색 마커**
   - 다른 사람이 등록한 글은 **빨간색 마커**
3. 마커 중 하나 클릭
4. **기대결과:**
   - 하단 패널(바텀시트) 슬라이드업 애니메이션
   - 분실물 정보 표시: 제목, 설명, 위치, 주소, 등록일
   - "내가 등록한 글"이면 "✓ 내가 등록한 글" 배지 표시
   - "상세 보기" 버튼 표시
5. "상세 보기" 클릭
6. **기대결과:**
   - 상세 페이지로 이동

**검증 포인트:**
- [ ] 좌표 없는 분실물은 지도에 표시 안 됨
- [ ] 마커 색상 구분 (녹색: 내 글, 빨간색: 타인 글)
- [ ] 마커 클릭 시 InfoWindow 표시
- [ ] 하단 패널 슬라이드업 애니메이션 부드러움

---

### ✅ 시나리오 4: 상세 페이지에서 지도 보기

**목표:** 상세 페이지에서 지도 확대 보기

**단계:**
1. 목록 페이지에서 좌표가 있는 분실물 클릭
2. 상세 페이지 확인
3. **기대결과:**
   - 작은 지도 미리보기 (300px) 표시
   - 해당 위치에 마커 1개 표시
   - 하단에 "🗺️ 큰 지도에서 보기" 버튼 표시
4. "큰 지도에서 보기" 클릭
5. **기대결과:**
   - 지도 페이지로 이동
   - 해당 분실물 마커가 자동 센터 + 줌 17
   - 노란색으로 강조 (BOUNCE 애니메이션)
   - 하단 패널 자동 열림

**검증 포인트:**
- [ ] 좌표 없는 분실물은 "위치 정보가 없습니다" 메시지 표시
- [ ] 마커 강조 애니메이션 작동
- [ ] 하단 패널에 올바른 정보 표시

---

### ✅ 시나리오 5: deviceId 기반 내 글 구분

**목표:** 로그인 없이 내가 등록한 글 구분

**단계:**
1. **새 브라우저 창** 또는 시크릿 모드로 접속
2. 분실물 1개 등록 (좌표 선택)
3. 목록 페이지 확인
4. **기대결과:**
   - 방금 등록한 글에 "내가 등록" 배지 표시
   - 카드가 다른 색상/스타일로 강조
5. 지도 페이지 확인
6. **기대결과:**
   - 내가 등록한 글의 마커는 **녹색**
   - 다른 글은 **빨간색**

**검증 포인트:**
- [ ] localStorage에 `lostfinder_device_id` 존재
- [ ] deviceId가 UUID v4 형식
- [ ] 브라우저 재시작해도 deviceId 유지
- [ ] 시크릿 모드에서는 다른 deviceId 생성

---

### ✅ 시나리오 6: 마커 선택 강조

**목표:** 선택된 마커가 확실히 구분됨

**단계:**
1. 지도 페이지에서 여러 마커 중 하나 클릭
2. **기대결과:**
   - 선택된 마커: **노란색**, 크기 **50px**, BOUNCE 애니메이션
   - 다른 마커: 빨간색/녹색, 크기 35px
3. 다른 마커 클릭
4. **기대결과:**
   - 이전 마커는 일반 상태로 복귀
   - 새로 선택한 마커가 노란색+BOUNCE

**검증 포인트:**
- [ ] 선택 시 자동 센터 이동 + 줌 17
- [ ] BOUNCE 애니메이션 작동
- [ ] 하단 패널 내용 업데이트

---

### ✅ 시나리오 7: 검색 실패 처리

**목표:** 검색 결과가 0건일 때 안내 메시지

**단계:**
1. 지도 페이지 검색창에 "ㅁㄴㅇㄹㅁㄴㅇㄹ" (의미 없는 문자) 입력
2. **기대결과:**
   - "검색 결과가 없어요. 다른 단어로 입력해 주세요." 메시지
   - 또는 자동완성 목록이 비어있음

**검증 포인트:**
- [ ] 서버 콘솔에 에러 로그 없음
- [ ] 사용자에게 적절한 피드백 제공

---

### ✅ 시나리오 8: 모바일 반응형 UI

**목표:** 모바일에서 터치가 쉽고 UI가 깨지지 않음

**단계:**
1. 개발자 도구 (F12) → 모바일 모드
2. 화면 크기: iPhone 12 (390x844)
3. 지도 페이지 확인
4. **기대결과:**
   - 검색창 크기 적절 (94% width)
   - 버튼 크기 최소 44x44px (터치 친화적)
   - 하단 패널이 화면의 50vh 이하로 제한
   - 텍스트 가독성 양호 (최소 14px)

**검증 포인트:**
- [ ] 모든 버튼이 터치 가능한 크기
- [ ] 지도 제스처 작동 (pinch zoom, pan)
- [ ] 하단 패널 스크롤 가능
- [ ] 가로 스크롤 발생 안 함

---

### ✅ 시나리오 9: API 키 없을 때 에러 처리

**목표:** API 키가 없어도 앱이 크래시되지 않음

**단계:**
1. `.env` 파일에서 `REACT_APP_GOOGLE_MAPS_API_KEY` 제거
2. 클라이언트 재시작
3. 지도 페이지 접속
4. **기대결과:**
   - 노란색 경고 박스 표시
   - "Google Maps API 키가 설정되지 않았습니다. ENV_SETUP.md를 참고하여 API 키를 설정해주세요."
   - 앱이 크래시되지 않음

**검증 포인트:**
- [ ] 콘솔에 명확한 에러 메시지
- [ ] 사용자에게 해결 방법 안내
- [ ] 다른 페이지는 정상 작동

---

### ✅ 시나리오 10: 서버 프록시 안정성

**목표:** Places API 호출이 서버를 통해 안전하게 처리

**단계:**
1. 브라우저 개발자 도구 → Network 탭
2. 지도 페이지에서 "서울역" 검색
3. Network 요청 확인
4. **기대결과:**
   - `/api/places/autocomplete?input=서울역` 요청 확인
   - `google.com` 직접 요청 없음 (서버 프록시 사용)
5. 서버 콘솔 확인
6. **기대결과:**
   - "✅ Places Autocomplete 성공" 로그 (또는 유사)

**검증 포인트:**
- [ ] 클라이언트에서 Google API 직접 호출 안 함
- [ ] 서버 응답 시간 1초 이내
- [ ] 에러 시 500 상태코드 + 명확한 에러 메시지

---

## 종합 체크리스트

### 기능 완성도
- [ ] 장소 검색 자동완성 (최대 6개)
- [ ] 좌표 획득 (lat, lng, placeName, address)
- [ ] 분실물 등록 시 좌표 저장
- [ ] 지도에 다중 마커 표시
- [ ] 마커 선택 강조 (노란색 + BOUNCE)
- [ ] 하단 패널 (바텀시트)
- [ ] 상세→지도 연결
- [ ] deviceId 기반 내 글 구분

### 안정성
- [ ] "카카오는 나왔다 아니다" 재현 안 됨
- [ ] API 키 없을 때 적절한 에러 메시지
- [ ] 검색 실패 시 적절한 피드백
- [ ] 서버 프록시 정상 작동
- [ ] 데이터베이스 스키마 정상 업데이트

### UI/UX
- [ ] 모바일 터치 친화적 (최소 44px 버튼)
- [ ] 애니메이션 부드러움 (슬라이드업, BOUNCE)
- [ ] 로딩 상태 표시 (스켈레톤, 스피너)
- [ ] 내 글 강조 (녹색 마커/배지)
- [ ] 다크 모드 대응 (CSS prefers-color-scheme)

### 배포 준비
- [ ] `.env.template` 파일 존재
- [ ] `ENV_SETUP.md` 문서 완성
- [ ] `README.md` 업데이트
- [ ] 환경변수 Vercel/Railway 설정 가이드

---

## 예상 문제 및 해결

### 문제 1: "카카오맵 API가 로드되지 않았습니다"
- **원인:** 기존 KakaoMapComponent 임포트 잔존
- **해결:** DetailPage에서 GoogleMapComponent로 교체 완료 ✅

### 문제 2: deviceId가 매번 새로 생성됨
- **원인:** localStorage 저장 실패
- **해결:** initializeDeviceId에서 생성 시간 저장 로직 추가 ✅

### 문제 3: 마커가 지도에 표시 안 됨
- **원인:** lat/lng가 null
- **해결:** 등록 시 반드시 좌표 포함 또는 지도에서 숨김 ✅

### 문제 4: Places API 할당량 초과
- **원인:** 디바운스 없이 매 입력마다 요청
- **해결:** 500ms 디바운스 적용 ✅

---

## 최종 검증 명령어

```bash
# 1. 데이터베이스 확인
cd server
node -e "const db = require('sqlite3').Database; const d = new db('./users.db'); d.all('PRAGMA table_info(lost_items)', console.log);"

# 2. 서버 로그 모니터링
npm start

# 3. 클라이언트 빌드 테스트
cd ../client
npm run build
# build 폴더 확인

# 4. deviceId 확인 (브라우저 콘솔)
localStorage.getItem('lostfinder_device_id')
```

---

## 성공 기준

✅ **모든 시나리오 10개 통과**  
✅ **종합 체크리스트 90% 이상 완료**  
✅ **"남사중학교" 검색 → 선택 → 등록 → 지도 확인 → 상세 확인 전체 플로우 연속 성공**

---

*테스트 완료 후 이 문서를 참고하여 사용자 매뉴얼 또는 데모 영상 제작 가능*


on:
  push:
    branches:
      - release/*
      - hotfix/*
  manual:
    branches: [ '*' ]

jobs:
  - name: build
    execute:
      # KODE에서 updateTestData task 실행 시 간헐적으로 실패해서 직접 clone 하도록 변경
      - git clone https://${GITHUB_USERNAME}:${GITHUB_PASSWORD}@github.daumkakao.com/kops/kakao-sdk-test-data
      - ./gradlew publishSdk -PNEXUS_USERNAME=${NEXUS_USERNAME} -PNEXUS_PASSWORD=${NEXUS_PASSWORD} -PNEXUS_RELEASE_REPOSITORY_URL=${NEXUS_RELEASE_REPOSITORY_URL} -PNEXUS_SNAPSHOT_REPOSITORY_URL=${NEXUS_SNAPSHOT_REPOSITORY_URL}
    run-on:
      image: +@android-jdk17
      resources: large
    caches:
      - key: gradle-caches
        path: ~/.gradle/caches
      - key: gradle-wrapper
        path: ~/.gradle/wrapper
    set-proxy: [ gradle, shell ]
